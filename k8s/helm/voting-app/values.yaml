# Default values for voting-app Helm chart
# This is a YAML-formatted file.

# Global settings
global:
  environment: production

# Namespace configuration
namespace:
  name: voting-app
  create: true
  labels:
    environment: production
  podSecurityStandards:
    enforce: restricted
    audit: restricted
    warn: restricted

# Application configuration
app:
  optionA: "Cats"
  optionB: "Dogs"

# PostgreSQL configuration
postgresql:
  enabled: true
  image:
    repository: postgres
    tag: "15-alpine"
    pullPolicy: IfNotPresent

  auth:
    username: postgres
    password: changeme-prod-password
    database: postgres

  persistence:
    enabled: true
    storageClass: standard
    size: 1Gi

  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 512Mi
      cpu: 500m

  securityContext:
    runAsNonRoot: true
    runAsUser: 999
    fsGroup: 999
    seccompProfile:
      type: RuntimeDefault

  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false

  service:
    type: ClusterIP
    port: 5432

# Redis configuration
redis:
  enabled: true
  image:
    repository: redis
    tag: "7-alpine"
    pullPolicy: IfNotPresent

  auth:
    password: ""

  persistence:
    enabled: true
    storageClass: standard
    size: 500Mi

  resources:
    requests:
      memory: 128Mi
      cpu: 100m
    limits:
      memory: 256Mi
      cpu: 250m

  securityContext:
    runAsNonRoot: true
    runAsUser: 999
    fsGroup: 999
    seccompProfile:
      type: RuntimeDefault

  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false

  service:
    type: ClusterIP
    port: 6379

# Vote service configuration
vote:
  enabled: true
  replicaCount: 2

  image:
    repository: tactful-votingapp-cloud-infra-vote
    tag: latest
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 80

  resources:
    requests:
      memory: 128Mi
      cpu: 100m
    limits:
      memory: 256Mi
      cpu: 250m

  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault

  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true

  probes:
    liveness:
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
    readiness:
      initialDelaySeconds: 10
      periodSeconds: 5
      timeoutSeconds: 3
      failureThreshold: 3

# Result service configuration
result:
  enabled: true
  replicaCount: 2

  image:
    repository: tactful-votingapp-cloud-infra-result
    tag: latest
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 4000

  resources:
    requests:
      memory: 128Mi
      cpu: 100m
    limits:
      memory: 256Mi
      cpu: 250m

  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault

  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true

  probes:
    liveness:
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
    readiness:
      initialDelaySeconds: 10
      periodSeconds: 5
      timeoutSeconds: 3
      failureThreshold: 3

# Worker service configuration
worker:
  enabled: true
  replicaCount: 1

  image:
    repository: tactful-votingapp-cloud-infra-worker
    tag: latest
    pullPolicy: IfNotPresent

  resources:
    requests:
      memory: 128Mi
      cpu: 100m
    limits:
      memory: 256Mi
      cpu: 250m

  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault

  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true

# Ingress configuration
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
  hosts:
    - host: vote.local
      paths:
        - path: /
          pathType: Prefix
          service: vote
          port: 80
    - host: result.local
      paths:
        - path: /
          pathType: Prefix
          service: result
          port: 4000

# Network Policies
networkPolicy:
  enabled: true
  policyTypes:
    - Ingress
  defaultDenyIngress: true

# Service Account
serviceAccount:
  create: true
  name: voting-app-sa
  annotations: {}
